<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Replace the website_sale.js file with custom js file -->
    <template id="assets_backend" name="website_sale_expand assets"
        inherit_id="website_sale_options.assets_frontend">
        <xpath
            expr="//script[contains(@src,'/website_sale_options/static/src/js/website_sale.js')]"
            position="replace">
            <script type="text/javascript"
                src="/bista_website_sale_options/static/src/js/website_sale.js" />
        </xpath>
    </template>
    <!-- Load custom less file of the module -->
    <template id="assets_maq_website_frontend" inherit_id="web.assets_frontend"
        name="MAQ Website Assets">
        <xpath expr="//link[last()]" position="after">
            <link rel="stylesheet" type="text/less"
                href="/bista_website_sale_options/static/src/less/maq_website.ui.component.less" />
        </xpath>
    </template>
    <!-- Changes in website add to cart modal on modal-title, modal-body and 
        modal-footer -->
    <template id="bista_website_sale_modal" name="Bista Website Sale Modal"
        inherit_id="website_sale_options.modal">
        <xpath
            expr="//div[contains(@class,'modal-dialog')]/div[@class='modal-content']/div[@class='modal-header']/h4[@class='modal-title']"
            position="replace">
            <h4 class="modal-title" id="myModalLabel">Product successfully added to your
                shopping cart
            </h4>
        </xpath>
        <xpath expr="//div[@class='modal-body']" position='replace'>
            <div class="modal-body">
                <table>
                    <thead>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div>
                                    <span t-field="product.image_medium" t-options='{"widget": "image" }' />
                                </div>
                            </td>
                            <td>&#160;</td>
                            <td>&#160;</td>
                            <td>&#160;</td>
                            <td>&#160;</td>
                            <td>&#160;</td>
                            <td>&#160;</td>
                            <td>&#160;</td>
                            <td>
                                <div>
                                    <span style='font-size: 20px;' t-field="product.name" />
                                </div>
                                <div>
                                    <span t-esc="product.description_sale" />
                                </div>
                                <div>
                                    <b>Quantity:-</b>
                                    <!-- <span t-esc="quantity"/> -->
                                    <input style="border: none; border-color: transparent;"
                                        type="text" data-min="1" name="add_qty" value="1" readonly="readonly" />
                                </div>
                                <div>
                                    <b>Total:-</b>
                                    <!-- <span class="text-danger oe_default_price oe_optional"
                                        t-field="product.lst_price"
                                        t-options='{
                                               "widget": "monetary",
                                               "from_currency": product.currency_id,
                                               "display_currency": website.currency_id
                                              }' /> -->
                                    <span class="oe_price" style="white-space: nowrap;"
                                        t-field="product.website_price"
                                        t-options='{
                                         "widget": "monetary",
                                         "display_currency": website.currency_id
                                      }' />
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </xpath>
        <xpath expr="//div[@class='modal-footer']" position='replace'>
            <div class="modal-footer">
                <a class="btn btn-default a-submit js_goto_shop invisible">
                    <i class="fa fa-chevron-left"></i>
                    <span class="hidden-xs">Continue Shopping</span>
                    <span class="visible-xs-inline">Continue</span>
                </a>
                <a class="btn btn-primary pull-right a-submit invisible">
                    <i class="fa fa-shopping-cart fa-fw"></i>
                    <span class="hidden-xs">Proceed to Checkout</span>
                    <span class="visible-xs-inline">Checkout</span>
                </a>
            </div>
        </xpath>
    </template>
    <!-- Improved product grid view on hover by showing price, adding message 
        for multiple variants and showing oe_website_spinner for adding quantity 
        and hiding product price on hover -->
    <template id="maq_products_item_inherit" name="MAQ Product Items"
        inherit_id="website_sale.products_item">
        <xpath expr="//div[@class='oe_product_image']" position="replace">
            <div class="oe_product_image">
                <a itemprop="url"
                    t-att-href="keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))">
                    <span itemprop="image"
                        t-attf-content="{{request.httprequest.url_root}}web/image/product.template/{{product.id}}/image"
                        t-field="product.image"
                        t-options="{'widget': 'image', 'resize': None if product_image_big else '300x300', 'zoom': 'image'}"
                        t-att-alt="product.name" />
                </a>
                <div class='maq_middle'>
                    <div class="maq_text">
                        <span t-esc="product.website_price"
                            t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" />
                    </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[hasclass('product_price')]" position="before">
            <t t-set="filterd_value_ids"
                t-value="product.product_variant_ids.filtered(lambda x:x.is_website_publish != False)" />
            <t t-if="len(filterd_value_ids) > 1">
                <div class="product_grid_qty">
                    <p>Multiple options available please select an option on product page
                    </p>
                </div>
            </t>
            <div t-if="len(filterd_value_ids) == 1"
                class="css_quantity input-group oe_website_spinner product_grid_qty">
                <a t-attf-href="#" class="mb8 input-group-addon js_add_cart_json hidden-xs">
                    <i class="fa fa-minus"></i>
                </a>
                <input type="text" class="js_quantity form-control quantity"
                    data-min="1" name="add_qty" value="1" />
                <a t-attf-href="#"
                    class="mb8 input-group-addon float_left js_add_cart_json hidden-xs">
                    <i class="fa fa-plus"></i>
                </a>
            </div>
        </xpath>
        <xpath expr="//section/div[@class='product_price']/b" position='replace'>
            <b>
                <t
                    t-if="product.website_price_difference and website.get_current_pricelist().discount_policy=='without_discount'">
                    <del class="text-danger mr8" style="white-space: nowrap;"
                        t-esc="compute_currency(product.website_public_price)"
                        t-options="{'widget': 'monetary', 'display_currency': website.get_current_pricelist().currency_id, 'from_currency': website.currency_id}" />
                </t>

                <span class='maq_hide_span' t-esc="product.website_price"
                    t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" />
                <span class='maq_hide_span' itemprop="price" style="display:none;"
                    t-esc="product.website_price" />
                <span class='maq_hide_span' itemprop="priceCurrency" style="display:none;"
                    t-esc="website.currency_id.name" />
            </b>
        </xpath>
    </template>

    <!-- Override products_add_to_cart from website sale -->
    <template id="website_sale.products_add_to_cart" inherit_id="website_sale.products_item"
        active="False" customize_show="True" name="Add to Cart">
        <xpath expr="//div[hasclass('product_price')]" position="inside">
            <input name="product_id" t-att-value="product.product_variant_id.id"
                type="hidden" />
            <t t-if="len(product.product_variant_ids) == 1">
                <!-- (=1)>><t t-esc="filterd_product_ids"/> -->
                <t
                    t-if="len(product.product_variant_ids) == 1 and product.product_variant_ids.filtered(lambda x:x.is_website_publish != False)">
                    <a class="btn btn-default btn-xs a-submit">
                        <span class="fa fa-shopping-cart" />
                    </a>
                </t>
                <t
                    t-if="len(product.product_variant_ids) == 1 and product.product_variant_ids.filtered(lambda x:x.is_website_publish == False)">
                    <a class="btn btn-default btn-xs a-submit hidden">
                        <span class="fa fa-shopping-cart" />
                    </a>
                </t>
            </t>

            <t
                t-if="len(product.product_variant_ids) &gt; 1 and product.product_variant_ids.filtered(lambda x:x.is_website_publish != False)">
                <t t-set="filterd_product_ids"
                    t-value="product.product_variant_ids.filtered(lambda x:x.is_website_publish != False)" />
                <t t-if="len(filterd_product_ids) == 1">
                    <a class="btn btn-default btn-xs a-submit">
                        <span class="fa fa-shopping-cart" />
                    </a>
                </t>
                <!-- (>1)>><t t-esc="filterd_product_ids"/> -->
                <t t-if="len(filterd_product_ids) &gt; 1">
                    <a class="btn btn-default btn-xs"
                        t-att-href="keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))">
                        <span class="fa fa-shopping-cart" />
                    </a>
                </t>
                <t t-if="len(filterd_product_ids) &lt; 1">
                    <a class="btn btn-default btn-xs a-submit hidden">
                        <span class="fa fa-shopping-cart" />
                    </a>
                </t>
            </t>
        </xpath>
    </template>

</odoo>

