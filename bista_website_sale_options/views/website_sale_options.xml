<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Changes in website add to cart modal on modal-title, modal-body and 
        modal-footer
        While adding cart into show following confirmation pop view-->

    <!--    <template id="bista_website_sale_modal" name="Bista Website Sale Modal"-->
    <!--              inherit_id="website.prompt">-->
    <!--<templates id="template" xml:space="preserve">-->
    <!--            <t t-inherit="website.prompt">-->
    <!--        <xpath expr="//div[hasclass('modal-dialog')]/div[hasclass('modal-content')]/div[hasclass('modal-header')]/h3[hasclass('modal-title')]"-->
    <!--               position="replace">-->
    <!--            <input type="text" class="quantity hidden"/>-->
    <!--            <div class="css_quantity hidden"/>-->
    <!--            <h4 class="modal-title" id="myModalLabel">Product successfully added to your-->
    <!--                shopping cart-->
    <!--            </h4>-->
    <!--        </xpath>-->
    <!--        <xpath expr="//div[hasclass('modal-body')]" position='replace'>-->
    <!--            <div class="modal-body">-->
    <!--                <table>-->
    <!--                    <thead>-->
    <!--                    </thead>-->
    <!--                    <tbody>-->
    <!--                        <tr>-->
    <!--                            <td>-->
    <!--                                <div>-->
    <!--                                    <span t-field="product.image_medium"-->
    <!--                                          t-options='{"widget": "image" }'/>-->
    <!--                                </div>-->
    <!--                            </td>-->
    <!--                            <td>&#160;</td>-->
    <!--                            <td>&#160;</td>-->
    <!--                            <td>&#160;</td>-->
    <!--                            <td>&#160;</td>-->
    <!--                            <td>&#160;</td>-->
    <!--                            <td>&#160;</td>-->
    <!--                            <td>&#160;</td>-->
    <!--                            <td>-->
    <!--                                <div>-->
    <!--                                    <span style='font-size: 20px;'>[</span>-->
    <!--                                    <span style='font-size: 20px;' t-esc="product.default_code"/>-->
    <!--                                    <span style='font-size: 20px;'>]</span>-->
    <!--                                    <span style='font-size: 20px;' t-field="product.name"/>-->
    <!--                                </div>-->
    <!--                                &lt;!&ndash;                                 <div>-->
    <!--                                                                    <span t-esc="product.description_sale"/>-->
    <!--                                                                </div> &ndash;&gt;-->
    <!--                                <div>-->
    <!--                                    <b>Quantity:-</b>-->
    <!--                                    <span t-esc="quantity"/>-->
    <!--                                    <input style="border: none; border-color: transparent;"-->
    <!--                                           type="hidden" data-min="1" name="add_qty" value="1" readonly="readonly"/>-->
    <!--                                </div>-->
    <!--                                <div groups="!ecommerce_category.group_hide_website_price">-->
    <!--                                    <b>Total:-</b>-->
    <!--                                    &lt;!&ndash; <span class="text-danger oe_default_price oe_optional"-->
    <!--                                          t-field="product.lst_price"-->
    <!--                                          t-options='{-->
    <!--                                               "widget": "monetary",-->
    <!--                                               "from_currency": product.currency_id,-->
    <!--                                               "display_currency": website.currency_id-->
    <!--                                              }'/> &ndash;&gt;-->
    <!--                                    <span class="oe_price" style="white-space: nowrap;"-->
    <!--                                          t-field="product.website_price"-->
    <!--                                          t-options='{-->
    <!--                                         "widget": "monetary",-->
    <!--                                         "display_currency": website.currency_id-->
    <!--                                      }'/>-->
    <!--                                </div>-->
    <!--                            </td>-->
    <!--                        </tr>-->
    <!--                    </tbody>-->
    <!--                </table>-->
    <!--            </div>-->
    <!--        </xpath>-->
    <!--        <xpath expr="//div[hasclass('modal-footer')]" position='replace'>-->
    <!--            <div class="modal-footer">-->
    <!--                <a class="btn btn-default a-submit js_goto_shop invisible">-->
    <!--                    <i class="fa fa-chevron-left"></i>-->
    <!--                    <span class="hidden-xs">Continue Shopping</span>-->
    <!--                    <span class="visible-xs-inline">Continue</span>-->
    <!--                </a>-->
    <!--                <a class="btn btn-primary pull-right a-submit invisible">-->
    <!--                    <i class="fa fa-shopping-cart fa-fw"></i>-->
    <!--                    <span class="hidden-xs">Proceed to Checkout</span>-->
    <!--                    <span class="visible-xs-inline">Checkout</span>-->
    <!--                </a>-->
    <!--            </div>-->
    <!--        </xpath>-->
    <!--            </t>-->
    <!--</templates>-->
    <!-- Improved product grid view on hover by showing price, adding message 
        for multiple variants and showing oe_website_spinner for adding quantity 
        and hiding product price on hover -->

    <template id="maq_products_item_inherit" name="MAQ Product Items"
              inherit_id="website_sale.products_item">
        <xpath expr="//span[contains(@t-attf-class, 'o_ribbon')]" position="replace">
            <t t-if="website.get_current_pricelist().discount_policy=='without_discount'">
                <span t-attf-class="o_ribbon o_ribbon_left" style="background-color:#ff4848;color:white;">
                    On Sale
                </span>
            </t>
            <t t-else="">
                <span t-attf-class="o_ribbon o_ribbon_left" style="background-color:#ff4848;color:white;">
                    Sale
                </span>
            </t>
        </xpath>

        <xpath expr="//div[hasclass('p-1')]" position="replace">
            <div class="card-body p-1 oe_product_image">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <a t-att-href="product_href" class="d-block h-100" itemprop="url">
                    <t t-set="image_holder" t-value="product._get_image_holder()"/>
                    <span t-field="image_holder.image_1920"
                          t-options="{'widget': 'image', 'preview_image': 'image_1024' if product_image_big else 'image_256', 'itemprop': 'image'}"
                          class="d-flex h-100 justify-content-center align-items-center"/>

                    <!--                    Object not receive-->
                    <!--                    <div class="maq_middle">-->
                    <!--                        <div class="maq_text" groups="!ecommerce_category.group_hide_website_price">-->
                    <!--&lt;!&ndash;                            product.website_price_difference and &ndash;&gt;-->
                    <!--                            <t t-if="website.get_current_pricelist().discount_policy=='without_discount'">-->
                    <!--                                <del class="text-danger mr8" style="white-space: nowrap;"-->
                    <!--                                     t-esc="product.list_price"-->
                    <!--                                     t-options="{'widget': 'monetary', 'display_currency': website.get_current_pricelist().currency_id, 'from_currency': website.currency_id}"/>-->
                    <!--                            </t>-->
                    <!--                            <span t-esc="product.list_price"-->
                    <!--                                  t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                </a>

            </div>

        </xpath>
        <xpath expr="//div[hasclass('product_price')]" position="before">
            <t t-set="filterd_value_ids" t-value="product._get_published_product_ids()"/>
            <t t-if="len(filterd_value_ids) &gt; 1">
                <div class="product_grid_qty">
                    <p>Multiple options available please select an option on product page</p>
                </div>
            </t>
            <div t-if="len(filterd_value_ids) == 1" class="css_quantity input-group oe_website_spinner product_grid_qty"
                 groups="!ecommerce_category.group_hide_website_price">
                <!--                <form t-if="product._is_add_to_cart_possible()" action="/shop/cart/update" method="POST">-->

                <div class="css_quantity input-group d-inline-flex mr-2 my-1 align-middle" contenteditable="false">
                    <div class="input-group-prepend">
                        <a t-attf-href="#" class="btn btn-primary js_add_cart_json" aria-label="Remove one"
                           title="Remove one">
                            <i class="fa fa-minus"></i>
                        </a>
                    </div>
                    <input type="text" class="form-control quantity" data-min="1" name="add_qty"
                           t-att-value="add_qty or 1"/>
                    <div class="input-group-append">
                        <a t-attf-href="#" class="btn btn-primary float_left js_add_cart_json" aria-label="Add one"
                           title="Add one">
                            <i class="fa fa-plus"></i>
                        </a>
                    </div>

                    <div id="add_to_cart_wrap" class="d-inline input-group-append">
                        <!--                               js_check_product-->
                        <a role="button" id="quick_add_from_shop" style="font-size:14px;margin-left:20px;"
                           class="btn btn-primary btn-lg my-1 mr-1 px-1 font-weight-bold flex-grow-1"
                           href="#" t-on-click="_onClickCart()" data-arg1="28">
                            <i class="fa fa-shopping-cart mr-2"/>
                            <button name="product_id" t-att-value="product.product_variant_id.id" type="hidden" style="display:none;"/>
                            <input type="text" class="form-control quantity" data-min="1" name="add_qty" t-att-value="add_qty or 1" style="display:none;"/>
                            ADD TO CART
                        </a>
                        <div id="product_option_block" class="d-inline-block align-middle"/>
                    </div>
                </div>
                <!--                </form>-->

            </div>
            <t t-elif="len(filterd_value_ids) &lt; 1">
                <div class="product_grid_qty">
                    <p class="invisible">No options available please go to product page by click add to cart</p>
                </div>
            </t>

        </xpath>

        <xpath expr="//div[hasclass('product_price')]" position="replace">
            <b>
                <!--                product.website_price_difference and -->
                <t t-if="website.get_current_pricelist().discount_policy=='without_discount'">
                    <del class="maq_hide_span text-danger mr8" style="white-space: nowrap;"
                         t-esc="product.list_price"
                         t-options="{'widget': 'monetary', 'display_currency': website.get_current_pricelist().currency_id, 'from_currency': website.currency_id}"/>
                </t>
                <span class="oe_price" style="white-space: nowrap;" t-esc="combination_info['price']"
                      t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                <span itemprop="price" style="display:none;" t-esc="combination_info['price']"/>
                <span itemprop="priceCurrency" style="display:none;" t-esc="website.currency_id.name"/>
            </b>
            <br/>
        </xpath>
    </template>

    <!-- Override products_add_to_cart from website sale
    Replace add to cart icon with add to cart button in product sale section
    -->
    <template id="products_add_to_cart_inherit" inherit_id="website_sale.products_add_to_cart">
        <xpath expr="//input" position="replace">
            <t t-if="len(product._get_published_product_ids()) &gt; 0">
                <input name="product_id" t-att-value="product._get_published_product_ids()[0]" type="hidden"/>
            </t>
            <t t-if="len(product._get_published_product_ids()) == 0">
                <input name="product_id" t-att-value="'0'" type="hidden"/>
            </t>
        </xpath>
        <xpath expr="//div[hasclass('product_price')]/t[@t-if='len(product.product_variant_ids) &gt; 1']"
               position="replace">
            <t t-set="filterd_value_ids" t-value="product._get_published_product_ids()"/>
            <t t-if="len(filterd_value_ids) &gt; 1">
                <a class="btn btn-default btn-xs"
                   t-att-href="keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))">
                    <span>Add To Cart</span>
                </a>
            </t>
        </xpath>
        <xpath expr="//div[hasclass('product_price')]/t[@t-if='len(product.product_variant_ids) == 1']"
               position="replace">
            <t t-if="len(filterd_value_ids) == 1">
                <a class="btn btn-default btn-xs a-submit">
                    <span>Add To Cart</span>
                </a>
            </t>
            <t t-elif="len(filterd_value_ids) &lt; 1">
                <a class="btn btn-default btn-xs"
                   t-att-href="keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))">
                    <span>Currently Out Of Stock</span>
                </a>
            </t>
        </xpath>
    </template>

    <!-- show message Currently Out of Stock in website Cart lines -->
    <template id="ecommerce_category.cart_lines_maqabim" inherit_id="website_sale.cart_lines">
        <!--        Already in v15.-->
        <xpath expr="//td[hasclass('td-price')]" position="replace">
            <td class="text-center td-price" name="price">

                <t t-if="line.product_id.lst_price - line.price_reduce &gt; 0.01  and website.get_current_pricelist().discount_policy=='without_discount'">
                    <del t-attf-class="#{'text-danger mr8'}" style="white-space: nowrap;"
                         t-esc="line.product_id.lst_price"
                         t-options="{'widget': 'monetary', 'display_currency': website.get_current_pricelist().currency_id, 'from_currency': website.currency_id}"/>
                    <br/>
                </t>
                <span class="oe_price" style="white-space: nowrap;" t-esc="line.price_reduce"
                      t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                <span t-field="line.price_reduce_taxexcl" style="white-space: nowrap;"
                      t-options="{'widget': 'monetary', 'from_currency': website_sale_order.pricelist_id.currency_id, 'display_currency': website.currency_id}"
                      groups="sale.group_show_price_subtotal"/>
                <span t-field="line.price_reduce_taxinc" style="white-space: nowrap;"
                      t-options="{'widget': 'monetary', 'from_currency': website_sale_order.pricelist_id.currency_id, 'display_currency': website.currency_id}"
                      groups="sale.group_show_price_total"/>
            </td>
        </xpath>
        <xpath expr="//td[hasclass('td-product_name')]" position="replace">
            <td t-if="line.product_id.product_tmpl_id" class="td-product_name">
                <div>
                    <a t-attf-href="/shop/product/#{ slug(line.product_id.product_tmpl_id) }">
                        <strong t-esc="line.product_id.display_name"/>
                    </a>
                </div>
                <t t-if="line.product_id.is_product_variant_publish() == False">
                    <p style="display:inline-block;" class="text-danger">Currently Out of Stock</p>
                </t>
                <div class="text-muted hidden-xs small">
                    <t t-foreach="line.name.splitlines()[1:]" t-as="name_line">
                        <span>
                            <t t-esc="name_line"/>
                        </span>
                        <br/>
                    </t>
                </div>
                <a href="#" class="js_delete_product hidden-xs no-decoration">
                    <small>
                        <i class="fa fa-trash-o"/>
                        Remove
                    </small>
                </a>
            </td>
        </xpath>
    </template>

</odoo>

